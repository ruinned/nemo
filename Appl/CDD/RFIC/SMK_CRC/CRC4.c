/* CRC4 chcek */
//#include	"type.h"
//#include	"define.h"

#include "Rte_Type.h"



#define	CRC4_POLYNOMIAL 0x11
#define CRC4_POLYNOMIAL_CHK (CRC4_POLYNOMIAL<<4)&0xff /* 0x10 */


static const uint8 crc4_table[256]={
                          0x00,0x10,0x20,0x30,0x40,0x50,0x60,0x70,0x80,0x90,
                          0xA0,0xB0,0xC0,0xD0,0xE0,0xF0,0x10,0x00,0x30,0x20,
                          0x50,0x40,0x70,0x60,0x90,0x80,0xB0,0xA0,0xD0,0xC0,
                          0xF0,0xE0,0x20,0x30,0x00,0x10,0x60,0x70,0x40,0x50,
                          0xA0,0xB0,0x80,0x90,0xE0,0xF0,0xC0,0xD0,0x30,0x20,
                          0x10,0x00,0x70,0x60,0x50,0x40,0xB0,0xA0,0x90,0x80,
                          0xF0,0xE0,0xD0,0xC0,0x40,0x50,0x60,0x70,0x00,0x10,
                          0x20,0x30,0xC0,0xD0,0xE0,0xF0,0x80,0x90,0xA0,0xB0,
                          0x50,0x40,0x70,0x60,0x10,0x00,0x30,0x20,0xD0,0xC0,
                          0xF0,0xE0,0x90,0x80,0xB0,0xA0,0x60,0x70,0x40,0x50,
                          0x20,0x30,0x00,0x10,0xE0,0xF0,0xC0,0xD0,0xA0,0xB0,
                          0x80,0x90,0x70,0x60,0x50,0x40,0x30,0x20,0x10,0x00,
                          0xF0,0xE0,0xD0,0xC0,0xB0,0xA0,0x90,0x80,0x80,0x90,
                          0xA0,0xB0,0xC0,0xD0,0xE0,0xF0,0x00,0x10,0x20,0x30,
                          0x40,0x50,0x60,0x70,0x90,0x80,0xB0,0xA0,0xD0,0xC0,
                          0xF0,0xE0,0x10,0x00,0x30,0x20,0x50,0x40,0x70,0x60,
                          0xA0,0xB0,0x80,0x90,0xE0,0xF0,0xC0,0xD0,0x20,0x30,
                          0x00,0x10,0x60,0x70,0x40,0x50,0xB0,0xA0,0x90,0x80,
                          0xF0,0xE0,0xD0,0xC0,0x30,0x20,0x10,0x00,0x70,0x60,
                          0x50,0x40,0xC0,0xD0,0xE0,0xF0,0x80,0x90,0xA0,0xB0,
                          0x40,0x50,0x60,0x70,0x00,0x10,0x20,0x30,0xD0,0xC0,
                          0xF0,0xE0,0x90,0x80,0xB0,0xA0,0x50,0x40,0x70,0x60,
                          0x10,0x00,0x30,0x20,0xE0,0xF0,0xC0,0xD0,0xA0,0xB0,
                          0x80,0x90,0x60,0x70,0x40,0x50,0x20,0x30,0x00,0x10,
                          0xF0,0xE0,0xD0,0xC0,0xB0,0xA0,0x90,0x80,0x70,0x60,
                          0x50,0x40,0x30,0x20,0x10,0x00};
						  
						  
						  
						  

uint8 check_crc4(uint8 *data_ptr, uint8 data_size, uint8 data_remainder)
{
	register uint8 i, j;
	register uint8 crc_accum = 0;
	register uint8 crc_accum_re = 0;

	for(j=0; j<data_size; j++)
	{
		i = (crc_accum ^ *data_ptr++) & 0xff;
		crc_accum = crc4_table[i];
	}

	crc_accum_re = (crc_accum ^ *data_ptr) & 0xff;

	for(j=0; j<data_remainder; j++)
	{	
		if(crc_accum_re & 0x80L)	{crc_accum_re = (crc_accum_re << 1) ^ CRC4_POLYNOMIAL_CHK;}
		else						{crc_accum_re = (crc_accum_re << 1);}
	}
	crc_accum = (crc_accum_re>>4)&0xf;
	
	return crc_accum;
}

